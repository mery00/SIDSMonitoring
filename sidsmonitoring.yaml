metadata:
  name: sidsmonitoring
  labels:
    nuclio.io/project-name: 3a310a7f-209f-4cae-b094-fe67d7d1f350
spec:
  handler: "main:handler"
  runtime: nodejs
  resources: {}
  image: "nuclio/processor-sidsmonitoring:latest"
  minReplicas: 1
  maxReplicas: 1
  targetCPU: 75
  triggers:
    health:
      class: ""
      kind: mqtt
      url: "guest:guest@**INSERT HERE YOUR IP**:1883"
      attributes:
        subscriptions:
          - qos: 0
            topic: newborn/health
  version: 1
  build:
    image: ""
    noCache: false
    offline: false
    dependencies: []
    runtimeAttributes:
      repositories: []
    functionSourceCode: dmFyIGFtcXAgPSByZXF1aXJlKCdhbXFwbGliJyk7DQp2YXIgdXJsID0gcmVxdWlyZSgndXJsJyk7DQp2YXIgaHR0cCA9IHJlcXVpcmUoJ2h0dHAnKTsNCg0KbGV0IGV2ZW50X25hbWUxID0gIndhcm5pbmdfbWFpbCI7DQpsZXQgZXZlbnRfbmFtZTIgPSAid2FybmluZ19zbXMiOw0KbGV0IGFwaV9rZXkgPSAiSU5TRVJUIFlPVVIgU0VDUkVUIEtFWSBGUk9NIElGVFRUIjsNCmxldCB3YXJuaW5nID0gdHJ1ZTsNCg0KICAgICAgICBhc3luYyBmdW5jdGlvbiBsb2dnZXIobXNnKXsNCiAgICAgICAgICAgIHZhciBxID0gJ25ld2Jvcm4vbG9nJzsNCiAgICAgICAgICAgIGNvbnN0IGNvbm5lY3Rpb24gPSBhd2FpdCBhbXFwLmNvbm5lY3QoJ2FtcXA6Ly9ndWVzdDpndWVzdEBJTlNFUlQgWU9VUiBJUDo1NjcyJyk7DQogICAgICAgICAgICBjb25zdCBjaCA9IGF3YWl0IGNvbm5lY3Rpb24uY3JlYXRlQ2hhbm5lbCgpOw0KICAgICAgICAgICAgYXdhaXQgY2guYXNzZXJ0UXVldWUocSwge2R1cmFibGU6IGZhbHNlfSk7DQogICAgICAgICAgICBjaC5zZW5kVG9RdWV1ZShxLCBCdWZmZXIuZnJvbShtc2cpKTsNCiAgICAgICAgIH0NCg0KICAgICAgICAgbGV0IHNlbmRJRlRUVCA9IGFzeW5jIGZ1bmN0aW9uKGV2ZW50LCBrZXksIHZhbHVlMSwgdmFsdWUyLCB2YWx1ZTMpew0KICAgICAgICAgICAgdmFyIHBvc191cmwgPSBgaHR0cHM6Ly9tYWtlci5pZnR0dC5jb20vdHJpZ2dlci8ke2V2ZW50fS93aXRoL2tleS8ke2tleX1gOw0KICAgICAgICAgICAgbGV0IHBvc3REYXRhID0gSlNPTi5zdHJpbmdpZnkoeyB2YWx1ZTEsIHZhbHVlMiwgdmFsdWUzIH0pOw0KDQogICAgICAgICAgICB2YXIgcGFyc2VkVXJsID0gdXJsLnBhcnNlKHBvc191cmwpOw0KICAgICAgICAgICAgdmFyIHBvc3Rfb3B0aW9ucyA9IHsNCiAgICAgICAgICAgICAgICBob3N0bmFtZTogcGFyc2VkVXJsLmhvc3RuYW1lLA0KICAgICAgICAgICAgICAgIHBvcnQ6IHBhcnNlZFVybC5wb3J0LA0KICAgICAgICAgICAgICAgIHBhdGg6IHBhcnNlZFVybC5wYXRoLA0KICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLA0KICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsNCiAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJywNCiAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtTGVuZ3RoJzogcG9zdERhdGEubGVuZ3RoDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfTsgDQogICAgICAgICAgICB2YXIgcG9zdF9yZXEgPSBodHRwLnJlcXVlc3QocG9zdF9vcHRpb25zLCBmdW5jdGlvbihyZXMpIHsNCiAgICAgICAgICAgIHJlcy5zZXRFbmNvZGluZygndXRmOCcpOw0KICAgICAgICAgICAgcmVzLm9uKCdkYXRhJywgZnVuY3Rpb24gKGNodW5rKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1Jlc3BvbnNlOiAnICsgY2h1bmspOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0pOw0KDQogICAgICAgIC8vIFRyaWdnZXIgYSBQT1NUIHRvIHRoZSB1cmwgd2l0aCB0aGUgYm9keS4NCiAgICAgICAgcG9zdF9yZXEud3JpdGUocG9zdERhdGEpOw0KICAgICAgICBwb3N0X3JlcS5lbmQoKTsNCiAgICB9ICAgDQoNCiAgICAgICAgZXhwb3J0cy5oYW5kbGVyID0gZnVuY3Rpb24oY29udGV4dCwgZXZlbnQpIHsNCiAgICAgICAgICAgIHZhciBfZXZlbnQgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGV2ZW50KSk7DQogICAgICAgICAgICB2YXIgX2RhdGEgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKC4uLl9ldmVudC5ib2R5LmRhdGEpOw0KDQogICAgICAgICAgICBjb250ZXh0LmNhbGxiYWNrKCJmZWVkYmFjayAiK19kYXRhKTsNCiAgICAgICAgICAgIGxvZ2dlcigiVGhlIGluZm9ybWF0aW9uIGRldGVjdCBhcmU6ICIrX2RhdGEpOw0KICAgICAgICAgICAgdmFyIHdhcm5pbmcgID0gX2RhdGEuc2xpY2UoMTEsMTUpOw0KICAgICAgICAgICAgaWYod2FybmluZz09PSgidHJ1ZSIpKXsNCiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBfZGF0YS5zcGxpdCgiLCIpOw0KICAgICAgICAgICAgICAgIHZhciBoZWFydCA9IHZhbHVlWzFdLnNwbGl0KCI6Iik7DQogICAgICAgICAgICAgICAgdmFyIHRlbXBlcmF0dXJlID0gdmFsdWVbMl0uc3BsaXQoIjoiKTsNCiAgICAgICAgICAgICAgICBzZW5kSUZUVFQoZXZlbnRfbmFtZTEsIGFwaV9rZXksICJ7d2FybmluZzogdHJ1ZSIsImhlYXJ0OiAiK2hlYXJ0WzFdLCJ0ZW1wZXJhdHVyZTogIisgdGVtcGVyYXR1cmVbMV0pOw0KICAgICAgICAgICAgICAgIHNlbmRJRlRUVChldmVudF9uYW1lMiwgYXBpX2tleSwgInt3YXJuaW5nOiB0cnVlIiwiaGVhcnQ6ICIraGVhcnRbMV0sInRlbXBlcmF0dXJlOiAiKyB0ZW1wZXJhdHVyZVsxXSk7DQogICAgICAgICAgICB9DQogICAgICAgIH07
    commands:
      - 'npm install amqplib'
    codeEntryType: sourceCode
  platform: {}
  readinessTimeoutSeconds: 60
